<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Website Status</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Arial,Segoe UI,Roboto;margin:24px;background:#fafafa;color:#111}
    h1{margin-bottom:0}
    .muted{color:#555;margin-top:4px}
    .ok{color:#0a0;font-weight:600}
    .degraded{color:#c90;font-weight:600}
    .down{color:#c00;font-weight:600}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #eee;margin-left:8px;font-size:.85em}
    small{color:#666}
  </style>
</head>
<body>
  <h1>Public Website Status</h1>
  <div id="updated" class="muted"></div>

  <h2>Components</h2>
  <div id="components" class="grid"></div>

  <h2>Incidents</h2>
  <div id="incidents"></div>

  <script>
    const classFor = s => s.includes('degraded') ? 'degraded' : (s.includes('outage')||s.includes('down') ? 'down' : 'ok');
    fetch('health.json', {cache:'no-store'})
      .then(r=>r.json())
      .then(d=>{
        document.getElementById('updated').textContent = 'Updated: ' + new Date(d.updatedAt || Date.now()).toLocaleString();
        const comps = (d.components||[]).map(c=>`
          <div class="card">
            <div><strong>${c.name}</strong><span class="pill ${classFor(c.status)}">${c.status.replaceAll('_',' ')}</span></div>
            ${c.p95_load_ms?`<div>P95 full-page load: <strong>${c.p95_load_ms}</strong> ms</div>`:''}
            ${c.ttfb_ms?`<div>P95 TTFB: <strong>${c.ttfb_ms}</strong> ms</div>`:''}
            ${c.availability?`<div>Availability (last 15m): <strong>${(c.availability*100).toFixed(2)}%</strong></div>`:''}
            ${c.last_publish_age_h!=null?`<div>Last publish age: <strong>${c.last_publish_age_h}h</strong></div>`:''}
          </div>
        `).join('');
        document.getElementById('components').innerHTML = comps || '<p>No components.</p>';
        const inc = (d.incidents||[]).map(i=>`
          <div class="card">
            <div><strong>${i.name}</strong> — <em>${i.status}</em></div>
            <small>Start: ${new Date(i.startedAt).toLocaleString()}</small>
            <ul>${(i.updates||[]).map(u=>`<li><small>${new Date(u.at).toLocaleString()}</small> — <b>${u.state}</b>: ${u.message}</li>`).join('')}</ul>
          </div>
        `).join('');
        document.getElementById('incidents').innerHTML = inc || '<p>No active incidents.</p>';
      })
      .catch(e=>{ document.body.insertAdjacentHTML('beforeend','<p class="down">Failed to load status.</p>'); });
  </script>
</body>
</html>
